# jusDNCE Standalone/Embed Player Bundle

This player is generated by `services/playerExport.ts` and is designed to run as:

1. **Standalone HTML** – open the exported file directly.
2. **Embeddable iframe/widget** – load the file in an iframe and communicate with the postMessage API.
3. **Minimal overlay** – apply the `preset-overlay` or `preset-background` layout class to shrink or background-pin the UI.

## PostMessage API
Send a message to the iframe contentWindow:

```js
// must be called after a user gesture per autoplay policies
iFrame.contentWindow.postMessage({ type: 'jusdnce:start' }, '*');

// switch layout presets: overlay | widget | background
iFrame.contentWindow.postMessage({ type: 'jusdnce:layout', preset: 'overlay' }, '*');

// request adapter: file | system | spotify | apple | pandora | youtube | background
iFrame.contentWindow.postMessage({ type: 'jusdnce:adapter', adapter: 'system' }, '*');

// load an external URL (mp3/mp4/hls)
iFrame.contentWindow.postMessage({ type: 'jusdnce:load', url: 'https://example.com/track.mp3' }, '*');

// ask the embed to request mic
iFrame.contentWindow.postMessage({ type: 'jusdnce:mic' }, '*');
```

### Outbound events
The player posts events back to the parent window:

- `{ type: 'jusdnce:armed' }` – gesture gate dismissed, audio context resumed.
- `{ type: 'jusdnce:input', input: 'mic' | 'system' | 'media', url? }`
- `{ type: 'jusdnce:levels', payload: { bass, mid, high, energy, t } }`
- `{ type: 'jusdnce:beat', payload: { beat, phase, time } }`
- `{ type: 'jusdnce:layout', preset }`

## Permission + SDK requirements
- **Microphone**: requires HTTPS or `localhost`. Browser prompt appears when the user taps the mic button or sends `jusdnce:mic` after the gesture gate.
- **System audio**: uses `getDisplayMedia({ audio:true, video:true })`; users must pick a tab/window. Not all browsers supply loopback audio.
- **File/MP4**: triggered by the File / MP4 adapter; accepts `audio/*` and `video/mp4|webm`.
- **Spotify**: provide a Web Playback SDK token and initialize Spotify’s SDK before sending `adapter: 'spotify'`. The shim listens for `MediaSession` updates as a fallback.
- **Apple Music**: requires MusicKit JS initialization and a developer token.
- **Pandora**: requires their partner SDK; if unavailable, the shim falls back to media-session events.
- **YouTube**: works with the IFrame API or any page exposing Media Session metadata.

## Layout presets
- `preset-overlay`: small cut-out (≈320x240) with scaled controls.
- `preset-widget`: mid-size (≈640x480).
- `preset-background`: disables pointer events for reactive wallpaper/backdrop usage.

Users can also toggle the **Reactive BG** adapter pill inside the player to switch into the background preset without parent coordination.
